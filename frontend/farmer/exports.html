<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Exports | Farmer Dashboard | Caravan of Flavours</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/styles.css">
    <script src="../assets/js/custom-ui.js?v=1.5"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF7E21',
                        'primary-hover': '#E66D1A',
                        'bg-dark': '#0C0A09',
                    }
                }
            }
        }
    </script>
</head>

<body style="background: #fafaf9; color: #1c1917; font-family: 'Outfit', sans-serif;">
    <aside
        style="width: 200px; background: white; border-right: 1px solid #e7e5e4; position: fixed; height: 100vh; padding: 24px; z-index: 50; overflow-y: auto;">
        <div class="logo" style="margin-bottom: 40px; display: flex; align-items: center; gap: 14px;">
            <img src="../assets/images/logo.png" alt="Logo" style="height: 42px; width: auto; object-fit: contain;">
            <div style="display: flex; flex-direction: column;">
                <h3
                    style="font-size: 18px; color: #1c1917; font-weight: 700; line-height: 1.1; letter-spacing: -0.02em;">
                    Caravan</h3>
                <small
                    style="font-size: 10px; color: #a8a29e; letter-spacing: 0.1em; font-weight: 700; text-transform: uppercase;">Of
                    Flavours</small>
            </div>
        </div>

        <nav style="display: flex; flex-direction: column; gap: 4px;">
            <a href="farmer-dashboard.html"
                style="display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 8px; text-decoration: none; color: #1c1917; font-weight: 500; font-size: 14px; transition: all 0.2s;"
                onmouseover="this.style.background='#fafaf9'" onmouseout="this.style.background='transparent'">
                <img src="https://api.iconify.design/lucide:layout-dashboard.svg?color=%231c1917" width="18" alt="">
                Dashboard
            </a>
            <a href="inventory.html"
                style="display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 8px; text-decoration: none; color: #1c1917; font-weight: 500; font-size: 14px; transition: all 0.2s;"
                onmouseover="this.style.background='#fafaf9'" onmouseout="this.style.background='transparent'">
                <img src="https://api.iconify.design/lucide:package.svg?color=%231c1917" width="18" alt="">
                Inventory
            </a>
            <a href="orders.html"
                style="display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 8px; text-decoration: none; color: #1c1917; font-weight: 500; font-size: 14px; transition: all 0.2s;"
                onmouseover="this.style.background='#fafaf9'" onmouseout="this.style.background='transparent'">
                <img src="https://api.iconify.design/lucide:shopping-cart.svg?color=%231c1917" width="18" alt="">
                Orders
            </a>
            <a href="exports.html"
                style="display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 8px; text-decoration: none; color: white; background: #FF7E21; font-weight: 700; font-size: 14px;">
                <img src="https://api.iconify.design/lucide:ship.svg?color=white" width="18" alt="">
                Exports
            </a>
            <a href="auctions.html"
                style="display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 8px; text-decoration: none; color: #1c1917; font-weight: 500; font-size: 14px; transition: all 0.2s;"
                onmouseover="this.style.background='#fafaf9'" onmouseout="this.style.background='transparent'">
                <img src="https://api.iconify.design/lucide:gavel.svg?color=%231c1917" width="18" alt="">
                Auctions
            </a>
            <a href="analysis.html"
                style="display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 8px; text-decoration: none; color: #1c1917; font-weight: 500; font-size: 14px; transition: all 0.2s;"
                onmouseover="this.style.background='#fafaf9'" onmouseout="this.style.background='transparent'">
                <img src="https://api.iconify.design/lucide:bar-chart-3.svg?color=%231c1917" width="18" alt="">
                Analysis
            </a>
            <a href="profile.html"
                style="display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 8px; text-decoration: none; color: #1c1917; font-weight: 500; font-size: 14px; transition: all 0.2s;"
                onmouseover="this.style.background='#fafaf9'" onmouseout="this.style.background='transparent'">
                <img src="https://api.iconify.design/lucide:user.svg?color=%231c1917" width="18" alt="">
                Profile
            </a>
        </nav>

        <div style="position: absolute; bottom: 24px; left: 24px; right: 24px;">
            <button onclick="logout()"
                style="display: flex; align-items: center; justify-content: center; gap: 12px; padding: 12px 16px; border-radius: 8px; text-decoration: none; color: #ff0000; background: transparent; border: 2px solid #ff0000; width: 100%; cursor: pointer; font-weight: 700; font-size: 14px;">
                <img src="https://api.iconify.design/lucide:log-out.svg?color=%23ff0000" width="18"
                    style="transform: rotate(180deg);" alt="">
                Sign Out
            </button>
        </div>
    </aside>

    <main style="margin-left: 200px; padding: 32px 40px; min-height: 100vh;">
        <header style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 40px;">
            <div>
                <h1 style="font-size: 32px; font-weight: 700; color: #1c1917; letter-spacing: -0.02em;">Global Exports
                </h1>
                <p style="font-size: 15px; color: #1c1917; margin-top: 4px;">Track your international shipments and
                    compliance documents.</p>
            </div>

            <button onclick="document.getElementById('addExportModal').classList.remove('hidden')"
                class="bg-primary hover:bg-primary-hover text-white px-8 py-4 rounded-2xl font-bold text-sm flex items-center gap-3 transition-all shadow-xl shadow-primary/20 transform hover:-translate-y-0.5 active:scale-95">
                <img src="https://api.iconify.design/lucide:plane-takeoff.svg?color=white" width="20" alt="">
                REGISTER SHIPMENT
            </button>
        </header>

        <!-- Export Stats -->
        <div class="grid grid-cols-4 gap-6 mb-10">
            <div class="bg-white p-6 rounded-[28px] border border-stone-200 shadow-sm flex items-center gap-4">
                <div class="w-12 h-12 bg-orange-50 rounded-2xl flex items-center justify-center">
                    <img src="https://api.iconify.design/lucide:box.svg?color=%23FF7E21" width="24">
                </div>
                <div>
                    <p class="text-[10px] font-bold text-stone-400 uppercase tracking-widest">Active Ships</p>
                    <p id="active-exports-count" class="text-xl font-bold text-stone-900">0</p>
                </div>
            </div>
            <div class="bg-white p-6 rounded-[28px] border border-stone-200 shadow-sm flex items-center gap-4">
                <div class="w-12 h-12 bg-blue-50 rounded-2xl flex items-center justify-center">
                    <img src="https://api.iconify.design/lucide:globe.svg?color=%233b82f6" width="24">
                </div>
                <div>
                    <p class="text-[10px] font-bold text-stone-400 uppercase tracking-widest">Countries</p>
                    <p id="countries-count" class="text-xl font-bold text-stone-900">0</p>
                </div>
            </div>
            <div class="bg-white p-6 rounded-[28px] border border-stone-200 shadow-sm flex items-center gap-4">
                <div class="w-12 h-12 bg-green-50 rounded-2xl flex items-center justify-center">
                    <img src="https://api.iconify.design/lucide:check-circle.svg?color=%2310b981" width="24">
                </div>
                <div>
                    <p class="text-[10px] font-bold text-stone-400 uppercase tracking-widest">Delivered</p>
                    <p id="delivered-count" class="text-xl font-bold text-stone-900">0</p>
                </div>
            </div>
            <div class="bg-white p-6 rounded-[28px] border border-stone-200 shadow-sm flex items-center gap-4">
                <div class="w-12 h-12 bg-purple-50 rounded-2xl flex items-center justify-center">
                    <img src="https://api.iconify.design/lucide:file-text.svg?color=%23a855f7" width="24">
                </div>
                <div>
                    <p class="text-[10px] font-bold text-stone-400 uppercase tracking-widest">Documents</p>
                    <p id="docs-count" class="text-xl font-bold text-stone-900">0</p>
                </div>
            </div>
        </div>

        <!-- Exports Table -->
        <div class="bg-white rounded-[32px] border border-stone-200 overflow-hidden shadow-sm">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-stone-50/50 border-bottom border-stone-100">
                        <th class="px-8 py-5 text-[11px] font-bold text-stone-400 uppercase tracking-widest">Shipment
                            Info</th>
                        <th class="px-8 py-5 text-[11px] font-bold text-stone-400 uppercase tracking-widest">Destination
                        </th>
                        <th class="px-8 py-5 text-[11px] font-bold text-stone-400 uppercase tracking-widest">Quantity
                        </th>
                        <th class="px-8 py-5 text-[11px] font-bold text-stone-400 uppercase tracking-widest">Status</th>
                        <th class="px-8 py-5 text-[11px] font-bold text-stone-400 uppercase tracking-widest">Tracking
                        </th>
                        <th class="px-8 py-5 text-[11px] font-bold text-stone-400 uppercase tracking-widest text-right">
                            Actions</th>
                    </tr>
                </thead>
                <tbody id="exports-table-body">
                    <tr>
                        <td colspan="6" class="px-8 py-20 text-center">
                            <img src="https://api.iconify.design/lucide:loader-2.svg"
                                class="w-8 h-8 animate-spin mx-auto text-primary mb-4">
                            <p class="text-stone-400 text-sm font-medium">Syncing global logistics...</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </main>

    <!-- Register Export Modal -->
    <div id="addExportModal"
        class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] hidden flex items-center justify-center p-6">
        <div class="bg-white p-10 rounded-[40px] w-full max-w-2xl relative shadow-2xl animate-in zoom-in-95 duration-200 max-h-[90vh] overflow-y-auto"
            onclick="event.stopPropagation()">
            <button onclick="document.getElementById('addExportModal').classList.add('hidden')"
                class="absolute top-8 right-8 text-stone-400 hover:text-stone-600">
                <img src="https://api.iconify.design/lucide:x.svg" width="28">
            </button>
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-stone-900 tracking-tight">Register International Shipment</h2>
                <p class="text-stone-500 mt-2 text-sm italic">Ensure all compliance data is entered accurately for
                    customs clearance.</p>
            </div>

            <form id="addExportForm" onsubmit="registerExport(event)" class="space-y-6">
                <div class="grid grid-cols-2 gap-6">
                    <div class="col-span-full">
                        <label class="block text-[11px] font-bold text-stone-400 uppercase tracking-widest mb-2">Product
                            Name</label>
                        <input type="text" name="product_name" required placeholder="e.g. Bulk Whole Cloves"
                            class="w-full px-5 py-4 bg-stone-50 border border-stone-100 rounded-2xl focus:border-primary outline-none transition-all text-sm font-semibold">
                    </div>
                    <div>
                        <label
                            class="block text-[11px] font-bold text-stone-400 uppercase tracking-widest mb-2">Destination
                            Country</label>
                        <select name="destination_country" required
                            class="w-full px-5 py-4 bg-stone-50 border border-stone-100 rounded-2xl focus:border-primary outline-none transition-all text-sm font-semibold">
                            <option value="">Select country...</option>
                            <option value="United Arab Emirates">United Arab Emirates</option>
                            <option value="India">India</option>
                            <option value="USA">USA</option>
                            <option value="Germany">Germany</option>
                            <option value="Japan">Japan</option>
                            <option value="UK">UK</option>
                        </select>
                    </div>
                    <div>
                        <label
                            class="block text-[11px] font-bold text-stone-400 uppercase tracking-widest mb-2">Quantity</label>
                        <div class="relative">
                            <input type="number" step="0.01" name="quantity" required placeholder="500.00"
                                class="w-full px-5 py-4 bg-stone-50 border border-stone-100 rounded-2xl focus:border-primary outline-none transition-all text-sm font-semibold">
                            <select name="unit"
                                class="absolute right-2 top-2 bottom-2 bg-white border border-stone-100 rounded-xl px-2 text-xs font-bold text-stone-500">
                                <option value="kg">kg</option>
                                <option value="ton">ton</option>
                                <option value="lb">lb</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <label
                            class="block text-[11px] font-bold text-stone-400 uppercase tracking-widest mb-2">Shipping
                            Carrier</label>
                        <input type="text" name="shipping_carrier" placeholder="e.g. Maersk / DHL"
                            class="w-full px-5 py-4 bg-stone-50 border border-stone-100 rounded-2xl focus:border-primary outline-none transition-all text-sm font-semibold">
                    </div>
                    <div>
                        <label
                            class="block text-[11px] font-bold text-stone-400 uppercase tracking-widest mb-2">Tracking
                            Number</label>
                        <input type="text" name="tracking_number" placeholder="e.g. MSCU1234567"
                            class="w-full px-5 py-4 bg-stone-50 border border-stone-100 rounded-2xl focus:border-primary outline-none transition-all text-sm font-semibold">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <label
                            class="block text-[11px] font-bold text-stone-400 uppercase tracking-widest mb-2">Shipment
                            Date</label>
                        <input type="date" name="shipment_date"
                            class="w-full px-5 py-4 bg-stone-50 border border-stone-100 rounded-2xl focus:border-primary outline-none transition-all text-sm font-semibold">
                    </div>
                    <div>
                        <label class="block text-[11px] font-bold text-stone-400 uppercase tracking-widest mb-2">Est.
                            Arrival</label>
                        <input type="date" name="estimated_arrival"
                            class="w-full px-5 py-4 bg-stone-50 border border-stone-100 rounded-2xl focus:border-primary outline-none transition-all text-sm font-semibold">
                    </div>
                </div>

                <div class="col-span-full pt-4">
                    <button type="submit"
                        class="w-full bg-primary hover:bg-primary-hover text-white py-5 rounded-[24px] font-bold text-sm tracking-widest shadow-2xl transition-all transform hover:-translate-y-1">
                        INITIATE EXPORT LOGISTICS
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        async function logout() {
            try {
                await fetch('../../backend/api/auth/logout.php');
                window.location.href = '../auth/login.html';
            } catch (error) { console.error('Logout error:', error); }
        }

        async function registerExport(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            const originalText = btn.innerText;
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            btn.disabled = true;
            btn.innerText = "PROCESSING LOGISTICS...";

            try {
                const response = await fetch('../../backend/api/exports/add-export.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                if (result.success) {
                    document.getElementById('addExportModal').classList.add('hidden');
                    loadExports();
                    e.target.reset();
                    showToast('Shipment registered successfully!', 'success');
                } else {
                    showToast('Error: ' + result.message, 'error');
                }
            } catch (error) {
                console.error('Error:', error);
            } finally {
                btn.disabled = false;
                btn.innerText = originalText;
            }
        }

        async function loadExports() {
            try {
                const response = await fetch('../../backend/api/exports/get-farmer-exports.php');
                const result = await response.json();
                const container = document.getElementById('exports-table-body');

                if (result.success && result.exports.length > 0) {
                    container.innerHTML = '';
                    let active = 0, delivered = 0, docs = 0;
                    const countries = new Set();

                    result.exports.forEach(exp => {
                        if (exp.status !== 'delivered' && exp.status !== 'cancelled') active++;
                        if (exp.status === 'delivered') delivered++;
                        countries.add(exp.destination_country);
                        docs += exp.documents.length;

                        const statusBadge = getStatusBadge(exp.status);

                        container.innerHTML += `
                            <tr class="border-b border-stone-50 hover:bg-stone-50/50 transition-colors">
                                <td class="px-8 py-6">
                                    <div class="font-bold text-stone-900 text-sm">${exp.product_name}</div>
                                    <div class="text-[10px] text-stone-400 font-bold uppercase mt-0.5">ID: #EXP-${exp.id.toString().padStart(5, '0')}</div>
                                </td>
                                <td class="px-8 py-6">
                                    <div class="flex items-center gap-2">
                                        <div class="w-6 h-6 bg-stone-100 rounded-full overflow-hidden flex items-center justify-center">
                                            <img src="https://api.iconify.design/lucide:map-pin.svg?color=%231c1917" width="12">
                                        </div>
                                        <span class="text-sm font-semibold text-stone-700">${exp.destination_country}</span>
                                    </div>
                                </td>
                                <td class="px-8 py-6">
                                    <span class="text-sm font-bold text-stone-900">${exp.quantity}${exp.unit}</span>
                                </td>
                                <td class="px-8 py-6">
                                    ${statusBadge}
                                </td>
                                <td class="px-8 py-6">
                                    <div class="text-sm font-mono text-stone-600">${exp.tracking_number || '--'}</div>
                                    <div class="text-[10px] text-stone-400 font-bold">${exp.shipping_carrier || 'No carrier assigned'}</div>
                                </td>
                                <td class="px-8 py-6 text-right">
                                    <button class="p-2 hover:bg-stone-100 rounded-xl transition-all">
                                        <img src="https://api.iconify.design/lucide:more-vertical.svg?color=%231c1917" width="18">
                                    </button>
                                </td>
                            </tr>
                        `;
                    });

                    document.getElementById('active-exports-count').innerText = `${active} ACTIVE NOW`;
                    document.getElementById('delivered-count').innerText = delivered;
                    document.getElementById('countries-count').innerText = countries.size;
                    document.getElementById('docs-count').innerText = docs;
                } else {
                    container.innerHTML = `
                        <tr>
                            <td colspan="6" class="px-8 py-32 text-center">
                                <div class="w-16 h-16 bg-stone-50 rounded-3xl flex items-center justify-center mx-auto mb-6">
                                    <img src="https://api.iconify.design/lucide:ship.svg?color=%23a8a29e" width="32">
                                </div>
                                <h3 class="text-lg font-bold text-stone-900 mb-1">No exports recorded</h3>
                                <p class="text-stone-400 text-sm max-w-xs mx-auto">Start your global expansion by registering your first international shipment.</p>
                            </td>
                        </tr>
                    `;
                }
            } catch (error) { console.error(error); }
        }

        function getStatusBadge(status) {
            const styles = {
                pending: 'bg-stone-100 text-stone-500',
                packaged: 'bg-blue-100 text-blue-700',
                customs: 'bg-amber-100 text-amber-700',
                shipped: 'bg-blue-100 text-blue-700',
                delivered: 'bg-emerald-100 text-emerald-700',
                cancelled: 'bg-rose-100 text-rose-700'
            };
            const s = (status || '').trim().toLowerCase();
            const label = s.toUpperCase() || 'PENDING';
            return `<span class="px-3 py-1 rounded-full text-[9px] font-bold tracking-widest ${styles[s] || styles.pending}">${label}</span>`;
        }

        window.onload = loadExports;
    </script>
</body>

</html>