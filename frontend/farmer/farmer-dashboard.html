<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farmer Dashboard | Caravan of Flavours</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/styles.css">
<<<<<<< HEAD
    <script src="../assets/js/custom-ui.js?v=1.4"></script>
=======
>>>>>>> 7a93d84e57fb4b8a4284292b9e5f4cf08fc28c30
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF7E21',
                        'primary-hover': '#E66D1A',
                        'bg-dark': '#0C0A09',
                    }
                }
            }
        }
    </script>
</head>

<body style="background: #fafaf9; color: #1c1917; font-family: 'Outfit', sans-serif;">
    <aside
        style="width: 200px; background: white; border-right: 1px solid #e7e5e4; position: fixed; height: 100vh; padding: 24px; z-index: 50; overflow-y: auto;">
        <div class="logo" style="margin-bottom: 40px; display: flex; align-items: center; gap: 14px;">
            <img src="../assets/images/logo.png" alt="Logo" style="height: 42px; width: auto; object-fit: contain;">
            <div style="display: flex; flex-direction: column;">
                <h3
                    style="font-size: 18px; color: #1c1917; font-weight: 700; line-height: 1.1; letter-spacing: -0.02em;">
                    Caravan</h3>
                <small
                    style="font-size: 10px; color: #a8a29e; letter-spacing: 0.1em; font-weight: 700; text-transform: uppercase;">Of
                    Flavours</small>
            </div>
        </div>

        <nav style="display: flex; flex-direction: column; gap: 4px;">
            <a href="farmer-dashboard.html"
                style="display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 8px; text-decoration: none; color: white; background: #FF7E21; font-weight: 700; font-size: 14px;">
                <img src="https://api.iconify.design/lucide:layout-dashboard.svg?color=white" width="18" alt="">
                Dashboard
            </a>
            <a href="inventory.html"
                style="display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 8px; text-decoration: none; color: #1c1917; font-weight: 500; font-size: 14px; transition: all 0.2s;"
                onmouseover="this.style.background='#fafaf9'" onmouseout="this.style.background='transparent'">
                <img src="https://api.iconify.design/lucide:package.svg?color=%231c1917" width="18" alt="">
                Inventory
            </a>
            <a href="orders.html"
                style="display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 8px; text-decoration: none; color: #1c1917; font-weight: 500; font-size: 14px; transition: all 0.2s;"
                onmouseover="this.style.background='#fafaf9'" onmouseout="this.style.background='transparent'">
                <img src="https://api.iconify.design/lucide:shopping-cart.svg?color=%231c1917" width="18" alt="">
                Orders
            </a>
            <a href="exports.html"
                style="display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 8px; text-decoration: none; color: #1c1917; font-weight: 500; font-size: 14px; transition: all 0.2s;"
                onmouseover="this.style.background='#fafaf9'" onmouseout="this.style.background='transparent'">
                <img src="https://api.iconify.design/lucide:ship.svg?color=%231c1917" width="18" alt="">
                Exports
            </a>
            <a href="auctions.html"
                style="display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 8px; text-decoration: none; color: #1c1917; font-weight: 500; font-size: 14px; transition: all 0.2s;"
                onmouseover="this.style.background='#fafaf9'" onmouseout="this.style.background='transparent'">
                <img src="https://api.iconify.design/lucide:gavel.svg?color=%231c1917" width="18" alt="">
                Auctions
            </a>
            <a href="analysis.html"
                style="display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 8px; text-decoration: none; color: #1c1917; font-weight: 500; font-size: 14px;">
                <img src="https://api.iconify.design/lucide:bar-chart-3.svg?color=%231c1917" width="18" alt="">
                Analysis
            </a>
            <a href="profile.html"
                style="display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 8px; text-decoration: none; color: #1c1917; font-weight: 500; font-size: 14px;">
                <img src="https://api.iconify.design/lucide:user.svg?color=%231c1917" width="18" alt="">
                Profile
            </a>
        </nav>

        <div style="position: absolute; bottom: 24px; left: 24px; right: 24px;">
            <button onclick="logout()"
                style="display: flex; align-items: center; justify-content: center; gap: 12px; padding: 12px 16px; border-radius: 8px; text-decoration: none; color: #ff0000; background: transparent; border: 2px solid #ff0000; width: 100%; cursor: pointer; font-weight: 700; font-size: 14px;">
                <img src="https://api.iconify.design/lucide:log-out.svg?color=%23ff0000" width="18"
                    style="transform: rotate(180deg);" alt="">
                Sign Out
            </button>
        </div>
    </aside>

    <main style="margin-left: 200px; padding: 32px 40px;">
        <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px;">
            <div>
                <h1 style="font-size: 24px; font-weight: 700; color: #1c1917;">Business Overview</h1>
                <p style="font-size: 14px; color: #1c1917; margin-top: 4px;">Welcome back! Here's what's happening
                    today.</p>
            </div>

            <div style="display: flex; align-items: center; gap: 16px;">
                <button onclick="window.location.href='inventory.html'"
                    class="bg-primary hover:bg-primary-hover text-white px-6 py-3 rounded-xl font-bold text-sm flex items-center gap-2 transition-all shadow-lg shadow-primary/20">
                    <img src="https://api.iconify.design/lucide:package.svg?color=white" width="18" alt="">
                    Manage Inventory
                </button>
            </div>
        </header>

        <!-- Stats Grid -->
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 32px;">
            <div
                style="background: white; border: 1px solid #e7e5e4; border-radius: 20px; padding: 24px; box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                    <div style="background: rgba(255, 126, 33, 0.1); padding: 10px; border-radius: 12px;">
                        <img src="https://api.iconify.design/lucide:banknote.svg?color=%23FF7E21" width="20" alt="">
                    </div>
                    <span style="font-size: 13px; font-weight: 700; color: #1c1917;">TOTAL REVENUE</span>
                </div>
                <div style="display: flex; align-items: center; gap: 4px; margin-top: 4px;">
                    <span class="currency-symbol"
                        style="font-size: 20px; color: #1c1917; font-weight: 700; opacity: 0.4;">$</span>
                    <div id="stat-revenue" style="font-size: 32px; font-weight: 700; color: #1c1917; line-height: 1;">
                        0.00</div>
                </div>
                <div
                    style="margin-top: 8px; font-size: 12px; color: #10b981; font-weight: 700; display: flex; align-items: center; gap: 4px;">
                    <img src="https://api.iconify.design/lucide:trending-up.svg?color=%2310b981" width="14" alt="">
                    Real-time data
                </div>
            </div>

            <div style="background: white; border: 1px solid #e7e5e4; border-radius: 20px; padding: 24px;">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                    <div style="background: rgba(59, 130, 246, 0.1); padding: 10px; border-radius: 12px;">
                        <img src="https://api.iconify.design/lucide:shopping-bag.svg?color=%233b82f6" width="20" alt="">
                    </div>
                    <span style="font-size: 13px; font-weight: 700; color: #1c1917;">ACTIVE ORDERS</span>
                </div>
                <div id="stat-orders" style="font-size: 28px; font-weight: 700; color: #1c1917;">0</div>
                <div style="margin-top: 8px; font-size: 12px; color: #3b82f6; font-weight: 700;">Currently open
                </div>
            </div>

            <div style="background: white; border: 1px solid #e7e5e4; border-radius: 20px; padding: 24px;">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                    <div style="background: rgba(16, 185, 129, 0.1); padding: 10px; border-radius: 12px;">
                        <img src="https://api.iconify.design/lucide:users.svg?color=%2310b981" width="20" alt="">
                    </div>
                    <span style="font-size: 13px; font-weight: 700; color: #1c1917;">CUSTOMERS</span>
                </div>
                <div id="stat-customers" style="font-size: 28px; font-weight: 700; color: #1c1917;">0</div>
                <div style="margin-top: 8px; font-size: 12px; color: #1c1917;">Unique buyers</div>
            </div>

            <div style="background: white; border: 1px solid #e7e5e4; border-radius: 20px; padding: 24px;">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
<<<<<<< HEAD
                    <div style="background: rgba(234, 179, 8, 0.1); padding: 10px; border-radius: 12px;">
                        <img src="https://api.iconify.design/lucide:star.svg?color=%23eab308" width="20" alt="">
                    </div>
                    <span style="font-size: 13px; font-weight: 700; color: #1c1917;">AVG RATING</span>
                </div>
                <div style="display: flex; align-items: baseline; gap: 8px;">
                    <div id="stat-rating" style="font-size: 28px; font-weight: 700; color: #1c1917;">0.0</div>
                    <div id="stat-rating-stars" class="flex gap-0.5 mb-1.5"
                        style="display: flex; gap: 2px; margin-bottom: 4px;">
                        <!-- Stars will be injected here -->
                    </div>
                </div>
                <div style="margin-top: 8px; font-size: 12px; color: #eab308; font-weight: 700;">Customer satisfaction
                </div>
=======
                    <div style="background: rgba(168, 85, 247, 0.1); padding: 10px; border-radius: 12px;">
                        <img src="https://api.iconify.design/lucide:package.svg?color=%23a855f7" width="20" alt="">
                    </div>
                    <span style="font-size: 13px; font-weight: 700; color: #1c1917;">TOTAL PRODUCTS</span>
                </div>
                <div id="stat-products" style="font-size: 28px; font-weight: 700; color: #1c1917;">0</div>
                <div style="margin-top: 8px; font-size: 12px; color: #a855f7; font-weight: 700;">Listed for sale</div>
>>>>>>> 7a93d84e57fb4b8a4284292b9e5f4cf08fc28c30
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 32px;">
            <!-- Top Sellers Section -->
            <div style="background: white; border: 1px solid #e7e5e4; border-radius: 24px; padding: 32px;">
                <h3 style="font-size: 18px; font-weight: 700; color: #1c1917; margin-bottom: 24px;">Top Selling Products
                </h3>
                <div id="top-sellers-list" style="display: flex; flex-direction: column; gap: 20px;">
                    <p style="color: #a8a29e; font-size: 12px;">No sales performance data yet.</p>
                </div>
            </div>

            <!-- Side Highlights -->
            <div style="display: flex; flex-direction: column; gap: 24px;">
                <!-- Loyal Customers -->
                <div style="background: #fdfcfb; border: 1px solid #e7e5e4; border-radius: 24px; padding: 24px;">
                    <h3 style="font-size: 16px; font-weight: 700; color: #1c1917; margin-bottom: 20px;">Loyal Customers
                    </h3>
                    <div id="top-customers-list" style="display: flex; flex-direction: column; gap: 16px;">
                        <p style="color: #a8a29e; font-size: 12px;">No repeat customers yet.</p>
                    </div>
                </div>

                <div style="background: white; border: 1px solid #e7e5e4; border-radius: 24px; padding: 24px;">
                    <h3 style="font-size: 16px; font-weight: 700; color: #1c1917; margin-bottom: 20px;">Recent Activity
                    </h3>
                    <div id="recent-activity-list" style="display: flex; flex-direction: column; gap: 16px;">
                        <p style="color: #a8a29e; font-size: 12px;">No activity yet.</p>
                    </div>
                </div>

                <!-- Completed Auctions Section -->
                <div style="background: #fdfcfb; border: 1px solid #e7e5e4; border-radius: 24px; padding: 24px;">
                    <h3 style="font-size: 16px; font-weight: 700; color: #1c1917; margin-bottom: 20px;">Auction Results
                    </h3>
                    <div id="completed-auctions-list" style="display: flex; flex-direction: column; gap: 16px;">
                        <p style="color: #a8a29e; font-size: 12px;">No closed auctions yet.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        async function logout() {
            try {
                await fetch('../../backend/api/auth/logout.php');
                window.location.href = '../auth/login.html';
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        window.onload = () => {
            CurrencyManager.init();
            loadStats();
        };

        async function loadStats() {
            // CurrencyManager.init() is called in onload and runs in bg
            try {
                const response = await fetch('../../backend/api/analytics/get-farmer-stats.php');
                const result = await response.json();

                if (result.success) {
                    // Update Stats Cards
<<<<<<< HEAD
<<<<<<< HEAD
                    document.getElementById('stat-revenue').textContent = formatCurrency(result.stats.revenue);
                    document.getElementById('stat-orders').textContent = result.stats.active_orders;
                    document.getElementById('stat-customers').textContent = result.stats.customers;

                    const rating = result.stats.rating;
                    document.getElementById('stat-rating').textContent = parseFloat(rating || 0).toFixed(1);

                    const starsContainer = document.getElementById('stat-rating-stars');
                    starsContainer.innerHTML = '';
                    if (rating > 0) {
                        for (let i = 1; i <= 5; i++) {
                            const isHalf = rating >= i - 0.5 && rating < i;
                            const isFull = rating >= i;
                            let starType = 'lucide:star';
                            let starColor = '#d6d3d1';

                            if (isFull) { starColor = '#eab308'; }
                            else if (isHalf) { starType = 'lucide:star-half'; starColor = '#eab308'; }

                            starsContainer.innerHTML += `<img src="https://api.iconify.design/${starType}.svg?color=${encodeURIComponent(starColor)}" width="14">`;
                        }
                    }
=======
                    document.getElementById('stat-revenue').textContent = `$${result.stats.revenue.toLocaleString(undefined, { minimumFractionDigits: 2 })}`;
=======
                    const rate = CurrencyManager.settings ? CurrencyManager.settings.rate : 1;
                    const convertedRevenue = parseFloat(result.stats.revenue) * rate;
                    document.getElementById('stat-revenue').textContent = convertedRevenue.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
>>>>>>> 967968b (added currency updation)
                    document.getElementById('stat-orders').textContent = result.stats.active_orders;
                    document.getElementById('stat-customers').textContent = result.stats.customers;

                    document.getElementById('stat-products').textContent = result.stats.total_products;
>>>>>>> 7a93d84e57fb4b8a4284292b9e5f4cf08fc28c30

                    // Update Recent Activity
                    const list = document.getElementById('recent-activity-list');
                    if (result.recent_activity.length > 0) {
                        list.innerHTML = '';
                        result.recent_activity.forEach(activity => {
                            const date = new Date(activity.order_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                            let icon = 'https://api.iconify.design/lucide:shopping-bag.svg?color=%23FF7E21';
                            let bgColor = '#fff7ed';

                            if (activity.status === 'delivered') {
                                icon = 'https://api.iconify.design/lucide:check-circle.svg?color=%2310b981';
                                bgColor = '#f0fdf4';
                            }

                            list.innerHTML += `
                                <div style="display: flex; gap: 12px;">
                                    <div style="width: 36px; height: 36px; border-radius: 50%; background: ${bgColor}; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                        <img src="${icon}" width="18" alt="">
                                    </div>
                                    <div style="overflow: hidden;">
                                        <p style="font-size: 13px; font-weight: 700; color: #1c1917; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${activity.product_name} • ${activity.customer_name}</p>
<<<<<<< HEAD
<<<<<<< HEAD
                                        <p style="font-size: 11px; color: #1c1917; margin-top: 2px;">${date} • ${formatCurrency(activity.total_price)}</p>
=======
                                        <p style="font-size: 11px; color: #1c1917; margin-top: 2px;">${date} • $${activity.total_price}</p>
>>>>>>> 7a93d84e57fb4b8a4284292b9e5f4cf08fc28c30
=======
                                        <p style="font-size: 11px; color: #1c1917; margin-top: 2px;">${date} • ${formatPrice(activity.total_price)}</p>
>>>>>>> 967968b (added currency updation)
                                    </div>
                                </div>`;
                        });
                    } else {
                        list.innerHTML = '<p style="color: #a8a29e; font-size: 12px; font-weight: 500;">No activity yet.</p>';
                    }

                    // Top Sellers
                    const sellerList = document.getElementById('top-sellers-list');
                    if (result.top_products && result.top_products.length > 0) {
                        sellerList.innerHTML = '';
                        const maxRev = Math.max(...result.top_products.map(p => p.revenue)) || 1;
                        result.top_products.slice(0, 3).forEach(p => {
                            const width = (p.revenue / maxRev) * 100;
                            sellerList.innerHTML += `
                                <div>
                                    <div style="display: flex; justify-content: space-between; font-size: 13px; font-weight: 700; margin-bottom: 8px;">
                                        <span style="color: #1c1917;">${p.product_name}</span>
<<<<<<< HEAD
<<<<<<< HEAD
                                        <span style="color: #FF7E21;">${formatCurrency(p.revenue)}</span>
=======
                                        <span style="color: #FF7E21;">$${parseFloat(p.revenue).toFixed(0)}</span>
>>>>>>> 7a93d84e57fb4b8a4284292b9e5f4cf08fc28c30
=======
                                        <span style="color: #FF7E21;">${formatPrice(p.revenue)}</span>
>>>>>>> 967968b (added currency updation)
                                    </div>
                                    <div style="width: 100%; height: 6px; background: #f5f5f4; border-radius: 3px; overflow: hidden;">
                                        <div style="width: ${width}%; height: 100%; background: #FF7E21; border-radius: 3px;"></div>
                                    </div>
                                </div>`;
                        });
                    } else {
                        sellerList.innerHTML = '<p style="color: #a8a29e; font-size: 12px;">No sales performance data yet.</p>';
                    }

                    // Top Customers
                    const customerList = document.getElementById('top-customers-list');
                    if (result.top_customers && result.top_customers.length > 0) {
                        customerList.innerHTML = '';
                        result.top_customers.forEach(c => {
                            customerList.innerHTML += `
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-size: 13px; font-weight: 700; color: #1c1917;">${c.full_name}</span>
                                    <span style="font-size: 11px; font-weight: 700; color: #10b981;">${c.order_count} Orders</span>
                                </div>`;
                        });
                    } else {
                        customerList.innerHTML = '<p style="color: #a8a29e; font-size: 12px;">No repeat customers yet.</p>';
                    }

                    // Auction Results
                    const auctionResultList = document.getElementById('completed-auctions-list');
                    if (result.auction_results && result.auction_results.length > 0) {
                        auctionResultList.innerHTML = '';
                        result.auction_results.forEach(a => {
                            const badgeColor = a.status === 'completed' ? '#10b981' : '#ff0000';
                            const badgeText = a.status === 'completed' ? 'SOLD' : 'NO BIDS';
                            auctionResultList.innerHTML += `
                                <div style="display: flex; justify-content: space-between; align-items: center; border-left: 3px solid ${badgeColor}; padding-left: 12px;">
                                    <div>
                                        <p style="font-size: 13px; font-weight: 700; color: #1c1917;">${a.product_name}</p>
                                        <p style="font-size: 11px; color: #1c1917;">Winner: ${a.winner_name || 'None'}</p>
                                    </div>
                                    <div style="text-align: right;">
                                        <p style="font-size: 12px; font-weight: 700; color: ${badgeColor};">${badgeText}</p>
<<<<<<< HEAD
<<<<<<< HEAD
                                        <p style="font-size: 11px; font-weight: 700; color: #1c1917;">${formatCurrency(a.current_bid)}</p>
=======
                                        <p style="font-size: 11px; font-weight: 700; color: #1c1917;">$${parseFloat(a.current_bid).toFixed(2)}</p>
>>>>>>> 7a93d84e57fb4b8a4284292b9e5f4cf08fc28c30
=======
                                        <p style="font-size: 11px; font-weight: 700; color: #1c1917;">${formatPrice(a.current_bid)}</p>
>>>>>>> 967968b (added currency updation)
                                    </div>
                                </div>`;
                        });
                    } else {
                        auctionResultList.innerHTML = '<p style="color: #a8a29e; font-size: 12px;">No closed auctions yet.</p>';
                    }
                }
            } catch (error) {
                console.error('Stats loading error:', error);
            }
        }

        function getStatusColor(status) {
            const colors = {
                'confirmed': '#10B981', 'pending': '#FACC15', 'shipped': '#3B82F6',
                'cancelled': '#EF4444', 'delivered': '#10B981'
            };
            return colors[status] || '#a8a29e';
        }
    </script>
    <script src="../assets/js/main.js"></script>
</body>

</html>